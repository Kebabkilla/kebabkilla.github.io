<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Bass Exercise - Altered Dominants</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        label {
            font-size: 14px;
            color: #aaa;
        }
        
        input[type="range"] {
            width: 200px;
        }
        
        button {
            background: #00d4ff;
            color: #1a1a2e;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #00b8e6;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }
        
        button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .fretboard {
            background: #2a2a2a;
            border-radius: 10px;
            padding: 30px;
            overflow-x: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .string {
            display: flex;
            align-items: center;
            margin: 15px 0;
            position: relative;
        }
        
        .string-label {
            width: 40px;
            font-weight: bold;
            color: #00d4ff;
            font-size: 18px;
        }
        
        .string-line {
            flex: 1;
            height: 2px;
            background: #555;
            position: relative;
            margin: 0 10px;
        }
        
        .fret {
            position: absolute;
            width: 60px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .fret-marker {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #555;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #888;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .fret-marker .fret-number {
            position: relative;
            z-index: 2;
        }
        
        .fret.active .fret-marker {
            border-color: #fff;
            color: #1a1a2e;
            font-weight: bold;
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.9);
            transform: scale(1.4);
        }
        
        .exercise-info {
            text-align: center;
            margin-top: 20px;
            font-size: 18px;
            color: #00d4ff;
        }
        
        .tempo-display {
            font-size: 24px;
            font-weight: bold;
            color: #00ff88;
        }
        
        .pattern-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .pattern-btn {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }
        
        .pattern-btn.active {
            background: #00d4ff;
        }
        
        .pattern-btn[data-pattern="0"] { border-left: 4px solid #ff6b6b; }
        .pattern-btn[data-pattern="1"] { border-left: 4px solid #ffd93d; }
        .pattern-btn[data-pattern="2"] { border-left: 4px solid #6bcb77; }
        .pattern-btn[data-pattern="3"] { border-left: 4px solid #9b59b6; }
        .pattern-btn[data-pattern="4"] { border-left: 4px solid #00d4ff; }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Color segments for multi-pattern notes */
        .color-segment {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé∏ Dynamic Bass Exercise - Altered Dominants</h1>
        
        <div class="controls">
            <div class="control-group">
                <label>Tempo: <span class="tempo-display" id="tempoDisplay">80</span> BPM</label>
                <input type="range" id="tempoSlider" min="40" max="200" value="80" step="5">
            </div>

            <div class="control-group">
                <label>Volume: <span id="volumeDisplay">70</span>%</label>
                <input type="range" id="volumeSlider" min="0" max="100" value="70" step="5">
            </div>
            
            <button id="playBtn">‚ñ∂ Play</button>
            <button id="stopBtn" disabled>‚èπ Stop</button>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6b6b;"></div>
                <span>F7alt (C Mel. Minor)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ffd93d;"></div>
                <span>A‚ô≠7alt (E‚ô≠ Mel. Minor)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #6bcb77;"></div>
                <span>B7alt (G‚ô≠ Mel. Minor)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #9b59b6;"></div>
                <span>D7alt (A Mel. Minor)</span>
            </div>
        </div>
        
        <div class="pattern-selector">
            <button class="pattern-btn active" data-pattern="0">Pattern 1: F7alt</button>
            <button class="pattern-btn" data-pattern="1">Pattern 2: A‚ô≠7alt</button>
            <button class="pattern-btn" data-pattern="2">Pattern 3: B7alt</button>
            <button class="pattern-btn" data-pattern="3">Pattern 4: D7alt</button>
            <button class="pattern-btn" data-pattern="4">All Patterns</button>
        </div>
        
        <div class="fretboard" id="fretboard">
            <div class="string">
                <div class="string-label">G</div>
                <div class="string-line" data-string="0"></div>
            </div>
            <div class="string">
                <div class="string-label">D</div>
                <div class="string-line" data-string="1"></div>
            </div>
            <div class="string">
                <div class="string-label">A</div>
                <div class="string-line" data-string="2"></div>
            </div>
            <div class="string">
                <div class="string-label">E</div>
                <div class="string-line" data-string="3"></div>
            </div>
        </div>
        
        <div class="exercise-info" id="exerciseInfo">
            Select a pattern and press Play to start
        </div>
    </div>

    <script>
        // Pattern colors
        const patternColors = [
            '#ff6b6b', // Red - F7alt
            '#ffd93d', // Yellow - Ab7alt
            '#6bcb77', // Green - B7alt
            '#9b59b6'  // Purple - D7alt
        ];
        
        // Audio Context for sound generation
        let audioContext;
        let masterGain;
        
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                masterGain = audioContext.createGain();
                masterGain.connect(audioContext.destination);
                masterGain.gain.value = 0.7;
            }
        }

        // Bass guitar frequencies (standard tuning: E A D G)
        const stringOpenFrequencies = {
            0: 196.00, // G
            1: 146.83, // D
            2: 110.00, // A
            3: 82.41   // E
        };

        function getFretFrequency(string, fret) {
            const openFreq = stringOpenFrequencies[string];
            return openFreq * Math.pow(2, fret / 12);
        }

        function playBassNote(string, fret, duration = 0.3) {
            initAudio();
            
            const now = audioContext.currentTime;
            const freq = getFretFrequency(string, fret);
            
            const osc1 = audioContext.createOscillator();
            const osc2 = audioContext.createOscillator();
            const osc3 = audioContext.createOscillator();
            
            osc1.type = 'sawtooth';
            osc2.type = 'sine';
            osc3.type = 'triangle';
            
            osc1.frequency.value = freq;
            osc2.frequency.value = freq;
            osc3.frequency.value = freq * 2;
            
            const gain1 = audioContext.createGain();
            const gain2 = audioContext.createGain();
            const gain3 = audioContext.createGain();
            
            gain1.gain.value = 0.3;
            gain2.gain.value = 0.5;
            gain3.gain.value = 0.15;
            
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 800 + (fret * 30);
            filter.Q.value = 1;
            
            const envelope = audioContext.createGain();
            envelope.gain.value = 0;
            envelope.gain.setValueAtTime(0, now);
            envelope.gain.linearRampToValueAtTime(1, now + 0.01);
            envelope.gain.exponentialRampToValueAtTime(0.6, now + 0.1);
            envelope.gain.linearRampToValueAtTime(0.4, now + duration - 0.05);
            envelope.gain.linearRampToValueAtTime(0, now + duration);
            
            osc1.connect(gain1);
            osc2.connect(gain2);
            osc3.connect(gain3);
            
            gain1.connect(filter);
            gain2.connect(filter);
            gain3.connect(filter);
            
            filter.connect(envelope);
            envelope.connect(masterGain);
            
            osc1.start(now);
            osc2.start(now);
            osc3.start(now);
            
            osc1.stop(now + duration);
            osc2.stop(now + duration);
            osc3.stop(now + duration);
        }

        // Exercise patterns - [string, fret, note name]
        const patterns = [
            // F7alt / C Melodic Minor (Red)
            [
                [3, 8, 'C'], [3, 10, 'D'], [3, 11, 'Eb'],
                [2, 8, 'F'], [2, 10, 'G'], [2, 12, 'Ab'],
                [1, 9, 'Bb'], [1, 10, 'C'], [1, 10, 'C'],
                [1, 9, 'Bb'], [2, 12, 'Ab'], [2, 10, 'G'],
                [2, 8, 'F'], [3, 11, 'Eb'], [3, 10, 'D'], [3, 8, 'C']
            ],
            // A‚ô≠7alt / E‚ô≠ Melodic Minor (Yellow)
            [
                [2, 6, 'Eb'], [2, 8, 'F'], [2, 9, 'Gb'],
                [2, 11, 'Ab'], [1, 8, 'Bb'], [1, 10, 'C'],
                [1, 12, 'Db'], [1, 12, 'Db'], [1, 10, 'C'],
                [1, 8, 'Bb'], [2, 11, 'Ab'], [2, 9, 'Gb'],
                [2, 8, 'F'], [2, 6, 'Eb']
            ],
            // B7alt / G‚ô≠ Melodic Minor (Green)
            [
                [3, 2, 'Gb'], [3, 4, 'Ab'], [3, 5, 'A'],
                [2, 2, 'B'], [2, 4, 'Db'], [2, 6, 'Eb'],
                [1, 3, 'F'], [1, 4, 'Gb'], [1, 4, 'Gb'],
                [1, 3, 'F'], [2, 6, 'Eb'], [2, 4, 'Db'],
                [2, 2, 'B'], [3, 5, 'A'], [3, 4, 'Ab'], [3, 2, 'Gb']
            ],
            // D7alt / A Melodic Minor (Purple)
            [
                [3, 5, 'A'], [3, 7, 'B'], [3, 8, 'C'],
                [2, 5, 'D'], [2, 7, 'E'], [2, 9, 'F'],
                [1, 6, 'G'], [1, 7, 'A'], [1, 7, 'A'],
                [1, 6, 'G'], [2, 9, 'F'], [2, 7, 'E'],
                [2, 5, 'D'], [3, 8, 'C'], [3, 7, 'B'], [3, 5, 'A']
            ]
        ];
        
        let currentPattern = 0;
        let isPlaying = false;
        let currentNoteIndex = 0;
        let intervalId = null;
        let tempo = 80;
        
        const tempoSlider = document.getElementById('tempoSlider');
        const tempoDisplay = document.getElementById('tempoDisplay');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeDisplay = document.getElementById('volumeDisplay');
        const playBtn = document.getElementById('playBtn');
        const stopBtn = document.getElementById('stopBtn');
        const exerciseInfo = document.getElementById('exerciseInfo');
        const fretboard = document.getElementById('fretboard');
        
        // Build a map of which patterns contain which fret positions
        function buildPatternMap() {
            const map = {};
            patterns.forEach((pattern, patternIndex) => {
                const uniquePositions = new Set();
                pattern.forEach(([string, fret]) => {
                    const key = `${string}-${fret}`;
                    if (!uniquePositions.has(key)) {
                        uniquePositions.add(key);
                        if (!map[key]) {
                            map[key] = [];
                        }
                        if (!map[key].includes(patternIndex)) {
                            map[key].push(patternIndex);
                        }
                    }
                });
            });
            return map;
        }
        
        const patternMap = buildPatternMap();
        
        // Create multi-colored background for notes in multiple patterns
        function createColorBackground(patternIndices) {
            if (patternIndices.length === 1) {
                return patternColors[patternIndices[0]];
            }
            
            const segments = patternIndices.length;
            const angle = 360 / segments;
            let gradient = 'conic-gradient(';
            
            patternIndices.forEach((pIndex, i) => {
                const startAngle = i * angle;
                const endAngle = (i + 1) * angle;
                gradient += `${patternColors[pIndex]} ${startAngle}deg ${endAngle}deg`;
                if (i < patternIndices.length - 1) gradient += ', ';
            });
            
            gradient += ')';
            return gradient;
        }
        
        // Initialize fretboard
        function initFretboard() {
            const strings = document.querySelectorAll('.string-line');
            strings.forEach((stringLine, stringIndex) => {
                for (let fret = 0; fret <= 15; fret++) {
                    const fretDiv = document.createElement('div');
                    fretDiv.className = 'fret';
                    fretDiv.style.left = `${fret * 60}px`;
                    fretDiv.dataset.string = stringIndex;
                    fretDiv.dataset.fret = fret;
                    
                    const marker = document.createElement('div');
                    marker.className = 'fret-marker';
                    
                    const fretNumber = document.createElement('span');
                    fretNumber.className = 'fret-number';
                    fretNumber.textContent = fret;
                    
                    marker.appendChild(fretNumber);
                    fretDiv.appendChild(marker);
                    stringLine.appendChild(fretDiv);
                    
                    // Click to hear individual notes
                    fretDiv.addEventListener('click', () => {
                        playBassNote(stringIndex, fret, 0.5);
                        highlightSingleNote(stringIndex, fret);
                        exerciseInfo.textContent = `Playing: String ${['G', 'D', 'A', 'E'][stringIndex]}, Fret ${fret}`;
                    });
                }
            });
        }
        
        function highlightSingleNote(string, fret) {
            document.querySelectorAll('.fret').forEach(f => f.classList.remove('active'));
            const fretEl = document.querySelector(
                `.string-line[data-string="${string}"] .fret:nth-child(${fret + 1})`
            );
            if (fretEl) {
                fretEl.classList.add('active');
            }
        }
        
        // Highlight scale notes with colors
        function highlightScale(patternIndex) {
            // Clear all highlights
            document.querySelectorAll('.fret').forEach(fret => {
                fret.classList.remove('in-scale', 'active');
                const marker = fret.querySelector('.fret-marker');
                marker.style.background = 'rgba(255, 255, 255, 0.1)';
                marker.style.borderColor = '#555';
                marker.style.color = '#888';
            });
            
            if (patternIndex === 4) {
                // All patterns - show multi-colored notes
                Object.entries(patternMap).forEach(([key, patternIndices]) => {
                    const [string, fret] = key.split('-').map(Number);
                    const fretEl = document.querySelector(
                        `.string-line[data-string="${string}"] .fret:nth-child(${fret + 1})`
                    );
                    if (fretEl) {
                        fretEl.classList.add('in-scale');
                        const marker = fretEl.querySelector('.fret-marker');
                        marker.style.background = createColorBackground(patternIndices);
                        marker.style.borderColor = patternIndices.length > 1 ? '#fff' : patternColors[patternIndices[0]];
                        marker.style.color = '#fff';
                        marker.style.textShadow = '0 0 3px rgba(0,0,0,0.8)';
                    }
                });
            } else {
                // Single pattern
                const uniquePositions = new Set();
                patterns[patternIndex].forEach(([string, fret]) => {
                    const key = `${string}-${fret}`;
                    if (!uniquePositions.has(key)) {
                        uniquePositions.add(key);
                        const fretEl = document.querySelector(
                            `.string-line[data-string="${string}"] .fret:nth-child(${fret + 1})`
                        );
                        if (fretEl) {
                            fretEl.classList.add('in-scale');
                            const marker = fretEl.querySelector('.fret-marker');
                            marker.style.background = patternColors[patternIndex];
                            marker.style.borderColor = patternColors[patternIndex];
                            marker.style.color = '#fff';
                            marker.style.textShadow = '0 0 3px rgba(0,0,0,0.5)';
                        }
                    }
                });
            }
        }
        
        // Play note with highlight
        function playNoteWithHighlight(string, fret, noteName, patternIndex) {
            document.querySelectorAll('.fret').forEach(f => f.classList.remove('active'));
            
            const fretEl = document.querySelector(
                `.string-line[data-string="${string}"] .fret:nth-child(${fret + 1})`
            );
            
            if (fretEl) {
                fretEl.classList.add('active');
            }
            
            const patternNames = ['F7alt', 'A‚ô≠7alt', 'B7alt', 'D7alt'];
            const color = patternColors[patternIndex];
            exerciseInfo.innerHTML = `Playing: <span style="color: ${color}; font-weight: bold;">${noteName}</span> (${patternNames[patternIndex]}) - String ${['G', 'D', 'A', 'E'][string]}, Fret ${fret}`;
        }
        
        // Start playback
        function startPlayback() {
            initAudio();
            isPlaying = true;
            currentNoteIndex = 0;
            playBtn.disabled = true;
            stopBtn.disabled = false;
            
            let currentPatterns = [];
            let patternIndicesForNotes = [];
            
            if (currentPattern === 4) {
                // All patterns combined
                patterns.forEach((pattern, pIndex) => {
                    pattern.forEach(note => {
                        currentPatterns.push(note);
                        patternIndicesForNotes.push(pIndex);
                    });
                });
            } else {
                currentPatterns = patterns[currentPattern];
                patternIndicesForNotes = currentPatterns.map(() => currentPattern);
            }
            
            const noteInterval = (60 / tempo) * 1000 / 2;
            const noteDuration = noteInterval / 1000 * 0.8;
            
            intervalId = setInterval(() => {
                if (currentNoteIndex >= currentPatterns.length) {
                    currentNoteIndex = 0;
                }
                
                const [string, fret, note] = currentPatterns[currentNoteIndex];
                const patternIdx = patternIndicesForNotes[currentNoteIndex];
                
                playNoteWithHighlight(string, fret, note, patternIdx);
                playBassNote(string, fret, noteDuration);
                currentNoteIndex++;
            }, noteInterval);
        }
        
        // Stop playback
        function stopPlayback() {
            isPlaying = false;
            playBtn.disabled = false;
            stopBtn.disabled = true;
            clearInterval(intervalId);
            document.querySelectorAll('.fret').forEach(f => f.classList.remove('active'));
            exerciseInfo.textContent = 'Stopped';
        }
        
        // Event listeners
        tempoSlider.addEventListener('input', (e) => {
            tempo = parseInt(e.target.value);
            tempoDisplay.textContent = tempo;
            
            if (isPlaying) {
                stopPlayback();
                startPlayback();
            }
        });

        volumeSlider.addEventListener('input', (e) => {
            const volume = parseInt(e.target.value);
            volumeDisplay.textContent = volume;
            if (masterGain) {
                masterGain.gain.value = volume / 100;
            }
        });
        
        playBtn.addEventListener('click', startPlayback);
        stopBtn.addEventListener('click', stopPlayback);
        
        document.querySelectorAll('.pattern-btn').forEach((btn, index) => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.pattern-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentPattern = index;
                highlightScale(index);
                
                if (isPlaying) {
                    stopPlayback();
                }
                
                const patternNames = ['F7alt / C Melodic Minor', 'A‚ô≠7alt / E‚ô≠ Melodic Minor', 
                                     'B7alt / G‚ô≠ Melodic Minor', 'D7alt / A Melodic Minor', 
                                     'All Patterns Combined'];
                exerciseInfo.textContent = `Selected: ${patternNames[index]}`;
            });
        });
        
        // Initialize
        initFretboard();
        highlightScale(0);
    </script>
</body>
</html>
