<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bass Finger Independence Exercise</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #aaa;
            margin-bottom: 20px;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        label {
            font-size: 14px;
            color: #aaa;
        }
        
        input[type="range"] {
            width: 150px;
        }
        
        button {
            background: #00d4ff;
            color: #1a1a2e;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #00b8e6;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }
        
        button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }
        
        .finger-legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .finger-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .finger-color {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        
        .current-pattern {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .pattern-display {
            font-size: 32px;
            font-weight: bold;
            letter-spacing: 8px;
            margin: 10px 0;
        }
        
        .pattern-number {
            color: #aaa;
            font-size: 14px;
        }
        
        .direction-indicator {
            margin-top: 10px;
            font-size: 16px;
            color: #00ff88;
        }
        
        .fretboard {
            background: linear-gradient(180deg, #3d2b1f 0%, #2a1f15 100%);
            border-radius: 10px;
            padding: 30px;
            overflow-x: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .fret-numbers {
            display: flex;
            margin-left: 40px;
            margin-bottom: 10px;
        }
        
        .fret-num {
            width: 50px;
            text-align: center;
            color: #888;
            font-size: 12px;
        }
        
        .string {
            display: flex;
            align-items: center;
            margin: 12px 0;
            position: relative;
        }
        
        .string-label {
            width: 40px;
            font-weight: bold;
            color: #00d4ff;
            font-size: 18px;
        }
        
        .string-line {
            flex: 1;
            height: 4px;
            background: linear-gradient(90deg, #b8860b 0%, #daa520 50%, #b8860b 100%);
            position: relative;
            margin: 0 10px;
            border-radius: 2px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        
        .string[data-string="0"] .string-line { height: 2px; }
        .string[data-string="1"] .string-line { height: 3px; }
        .string[data-string="2"] .string-line { height: 4px; }
        .string[data-string="3"] .string-line { height: 5px; }
        
        .fret {
            position: absolute;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .fret-marker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #555;
            transition: all 0.15s;
            position: relative;
        }
        
        .fret.active .fret-marker {
            transform: scale(1.5);
            box-shadow: 0 0 35px currentColor, 0 0 15px currentColor inset;
            z-index: 10;
            border-color: #fff !important;
        }
        
        .fret.in-pattern .fret-marker {
            color: #fff;
            font-weight: bold;
            border-width: 3px;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        .exercise-info {
            text-align: center;
            margin-top: 20px;
            font-size: 18px;
            color: #00d4ff;
            min-height: 30px;
        }
        
        .tempo-display, .start-fret-display {
            font-size: 24px;
            font-weight: bold;
            color: #00ff88;
        }
        
        .progress-container {
            margin-top: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
        }
        
        .progress-bar {
            height: 10px;
            background: #333;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            transition: width 0.3s;
            border-radius: 5px;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 10px;
            color: #aaa;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .nav-btn {
            padding: 8px 20px;
            font-size: 14px;
            background: rgba(255,255,255,0.1);
        }
        
        .nav-btn:hover {
            background: rgba(255,255,255,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé∏ Bass Finger Independence Exercise</h1>
        <p class="subtitle">All 24 permutations of 4-finger patterns across all strings</p>
        
        <div class="controls">
            <div class="control-group">
                <label>Tempo: <span class="tempo-display" id="tempoDisplay">70</span> BPM</label>
                <input type="range" id="tempoSlider" min="40" max="180" value="70" step="5">
            </div>

            <div class="control-group">
                <label>Start Fret: <span class="start-fret-display" id="startFretDisplay">5</span></label>
                <input type="range" id="startFretSlider" min="1" max="12" value="5" step="1">
            </div>

            <div class="control-group">
                <label>Volume: <span id="volumeDisplay">70</span>%</label>
                <input type="range" id="volumeSlider" min="0" max="100" value="70" step="5">
            </div>
            
            <button id="playBtn">‚ñ∂ Play</button>
            <button id="stopBtn" disabled>‚èπ Stop</button>
        </div>
        
        <div class="finger-legend">
            <div class="finger-item">
                <div class="finger-color" style="background: #ff6b6b;">1</div>
                <span>Index</span>
            </div>
            <div class="finger-item">
                <div class="finger-color" style="background: #ffd93d;">2</div>
                <span>Middle</span>
            </div>
            <div class="finger-item">
                <div class="finger-color" style="background: #6bcb77;">3</div>
                <span>Ring</span>
            </div>
            <div class="finger-item">
                <div class="finger-color" style="background: #9b59b6;">4</div>
                <span>Pinky</span>
            </div>
        </div>
        
        <div class="current-pattern">
            <div class="pattern-number">Pattern <span id="patternNum">1</span> of 24</div>
            <div class="pattern-display" id="patternDisplay">1-2-3-4</div>
            <div id="patternDesc" style="color: #aaa; font-size: 14px;">Index ‚Üí Middle ‚Üí Ring ‚Üí Pinky</div>
            <div class="direction-indicator" id="directionIndicator">‚Üì Forward: G ‚Üí D ‚Üí A ‚Üí E | ‚Üí Left to Right</div>
        </div>
        
        <div class="fretboard" id="fretboard">
            <div class="fret-numbers" id="fretNumbers"></div>
            <div class="string" data-string="0">
                <div class="string-label">G</div>
                <div class="string-line" data-string="0"></div>
            </div>
            <div class="string" data-string="1">
                <div class="string-label">D</div>
                <div class="string-line" data-string="1"></div>
            </div>
            <div class="string" data-string="2">
                <div class="string-label">A</div>
                <div class="string-line" data-string="2"></div>
            </div>
            <div class="string" data-string="3">
                <div class="string-label">E</div>
                <div class="string-line" data-string="3"></div>
            </div>
        </div>
        
        <div class="exercise-info" id="exerciseInfo">
            Press Play to start the exercise
        </div>
        
        <div class="nav-buttons">
            <button class="nav-btn" id="prevPattern">‚Üê Previous Pattern</button>
            <button class="nav-btn" id="nextPattern">Next Pattern ‚Üí</button>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-text" id="progressText">0% Complete</div>
        </div>
    </div>

    <script>
        // Finger colors
        const fingerColors = {
            1: '#ff6b6b',
            2: '#ffd93d',
            3: '#6bcb77',
            4: '#9b59b6'
        };
        
        const fingerNames = {
            1: 'Index',
            2: 'Middle',
            3: 'Ring',
            4: 'Pinky'
        };
        
        // Note names
        const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        const openNotes = { 0: 7, 1: 2, 2: 9, 3: 4 }; // G=7, D=2, A=9, E=4
        
        function getNoteName(string, fret) {
            const noteIndex = (openNotes[string] + fret) % 12;
            return noteNames[noteIndex];
        }
        
        // Generate all 24 permutations
        function getPermutations(arr) {
            if (arr.length <= 1) return [arr];
            const result = [];
            for (let i = 0; i < arr.length; i++) {
                const rest = [...arr.slice(0, i), ...arr.slice(i + 1)];
                const perms = getPermutations(rest);
                for (const perm of perms) {
                    result.push([arr[i], ...perm]);
                }
            }
            return result;
        }
        
        const allPermutations = getPermutations([1, 2, 3, 4]);
        
        // Audio
        let audioContext;
        let masterGain;
        
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                masterGain = audioContext.createGain();
                masterGain.connect(audioContext.destination);
                masterGain.gain.value = 0.7;
            }
        }

        const stringOpenFrequencies = {
            0: 196.00,
            1: 146.83,
            2: 110.00,
            3: 82.41
        };

        function getFretFrequency(string, fret) {
            return stringOpenFrequencies[string] * Math.pow(2, fret / 12);
        }

        function playBassNote(string, fret, duration = 0.3) {
            initAudio();
            const now = audioContext.currentTime;
            const freq = getFretFrequency(string, fret);
            
            const osc1 = audioContext.createOscillator();
            const osc2 = audioContext.createOscillator();
            const osc3 = audioContext.createOscillator();
            
            osc1.type = 'sawtooth';
            osc2.type = 'sine';
            osc3.type = 'triangle';
            
            osc1.frequency.value = freq;
            osc2.frequency.value = freq;
            osc3.frequency.value = freq * 2;
            
            const gain1 = audioContext.createGain();
            const gain2 = audioContext.createGain();
            const gain3 = audioContext.createGain();
            
            gain1.gain.value = 0.3;
            gain2.gain.value = 0.5;
            gain3.gain.value = 0.15;
            
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 800 + (fret * 30);
            filter.Q.value = 1;
            
            const envelope = audioContext.createGain();
            envelope.gain.setValueAtTime(0, now);
            envelope.gain.linearRampToValueAtTime(1, now + 0.01);
            envelope.gain.exponentialRampToValueAtTime(0.6, now + 0.08);
            envelope.gain.linearRampToValueAtTime(0.4, now + duration - 0.05);
            envelope.gain.linearRampToValueAtTime(0, now + duration);
            
            osc1.connect(gain1);
            osc2.connect(gain2);
            osc3.connect(gain3);
            gain1.connect(filter);
            gain2.connect(filter);
            gain3.connect(filter);
            filter.connect(envelope);
            envelope.connect(masterGain);
            
            osc1.start(now);
            osc2.start(now);
            osc3.start(now);
            osc1.stop(now + duration);
            osc2.stop(now + duration);
            osc3.stop(now + duration);
        }

        let currentPermutationIndex = 0;
        let isPlaying = false;
        let currentNoteIndex = 0;
        let intervalId = null;
        let tempo = 70;
        let startFret = 5;
        let isReverse = false;
        
        const tempoSlider = document.getElementById('tempoSlider');
        const tempoDisplay = document.getElementById('tempoDisplay');
        const startFretSlider = document.getElementById('startFretSlider');
        const startFretDisplay = document.getElementById('startFretDisplay');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeDisplay = document.getElementById('volumeDisplay');
        const playBtn = document.getElementById('playBtn');
        const stopBtn = document.getElementById('stopBtn');
        const exerciseInfo = document.getElementById('exerciseInfo');
        const patternDisplay = document.getElementById('patternDisplay');
        const patternNum = document.getElementById('patternNum');
        const patternDesc = document.getElementById('patternDesc');
        const directionIndicator = document.getElementById('directionIndicator');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const prevPatternBtn = document.getElementById('prevPattern');
        const nextPatternBtn = document.getElementById('nextPattern');
        const fretNumbers = document.getElementById('fretNumbers');
        
        function initFretboard() {
            for (let fret = 0; fret <= 15; fret++) {
                const numDiv = document.createElement('div');
                numDiv.className = 'fret-num';
                numDiv.textContent = fret;
                fretNumbers.appendChild(numDiv);
            }
            
            const strings = document.querySelectorAll('.string-line');
            strings.forEach((stringLine, stringIndex) => {
                for (let fret = 0; fret <= 15; fret++) {
                    const fretDiv = document.createElement('div');
                    fretDiv.className = 'fret';
                    fretDiv.style.left = `${fret * 50}px`;
                    fretDiv.dataset.string = stringIndex;
                    fretDiv.dataset.fret = fret;
                    
                    const marker = document.createElement('div');
                    marker.className = 'fret-marker';
                    marker.textContent = '';
                    
                    fretDiv.appendChild(marker);
                    stringLine.appendChild(fretDiv);
                    
                    fretDiv.addEventListener('click', () => {
                        playBassNote(stringIndex, fret, 0.4);
                        highlightSingleNote(stringIndex, fret);
                    });
                }
            });
        }
        
        function highlightSingleNote(string, fret) {
            document.querySelectorAll('.fret').forEach(f => f.classList.remove('active'));
            const fretEl = document.querySelector(`.string-line[data-string="${string}"] .fret:nth-child(${fret + 1})`);
            if (fretEl) fretEl.classList.add('active');
        }
        
        function updatePatternDisplay() {
            const perm = allPermutations[currentPermutationIndex];
            
            let coloredPattern = '';
            perm.forEach((finger, i) => {
                coloredPattern += `<span style="color: ${fingerColors[finger]}">${finger}</span>`;
                if (i < 3) coloredPattern += '<span style="color: #555">-</span>';
            });
            patternDisplay.innerHTML = coloredPattern;
            
            patternNum.textContent = currentPermutationIndex + 1;
            patternDesc.textContent = perm.map(f => fingerNames[f]).join(' ‚Üí ');
            
            highlightCurrentPattern();
        }
        
        function highlightCurrentPattern() {
            const perm = allPermutations[currentPermutationIndex];
            
            document.querySelectorAll('.fret').forEach(fret => {
                fret.classList.remove('in-pattern', 'active');
                const marker = fret.querySelector('.fret-marker');
                marker.style.background = 'rgba(255, 255, 255, 0.05)';
                marker.style.borderColor = 'transparent';
                marker.style.color = '#555';
                marker.style.boxShadow = 'none';
                marker.textContent = '';
            });
            
            // Display fingers in order on fretboard from LEFT to RIGHT
            // perm[0] goes to position 0 (startFret), perm[1] goes to position 1 (startFret+1), etc.
            for (let string = 0; string < 4; string++) {
                perm.forEach((finger, position) => {
                    const fret = startFret + position;
                    const fretEl = document.querySelector(`.string-line[data-string="${string}"] .fret:nth-child(${fret + 1})`);
                    if (fretEl) {
                        fretEl.classList.add('in-pattern');
                        const marker = fretEl.querySelector('.fret-marker');
                        marker.style.background = fingerColors[finger];
                        marker.style.borderColor = fingerColors[finger];
                        marker.style.color = '#fff';
                        marker.style.boxShadow = `0 0 10px ${fingerColors[finger]}50`;
                        marker.textContent = finger; // Show FINGER number
                    }
                });
            }
        }
        
        function buildFullExercise() {
            const perm = allPermutations[currentPermutationIndex];
            const notes = [];
            
            // FORWARD: G(0) ‚Üí D(1) ‚Üí A(2) ‚Üí E(3), left to right
            for (let string = 0; string < 4; string++) {
                for (let position = 0; position < 4; position++) {
                    const finger = perm[position];
                    const displayFret = startFret + position; // Visual position (left to right)
                    const soundFret = startFret + (finger - 1); // Sound based on finger number
                    notes.push({ 
                        string, 
                        displayFret, 
                        soundFret, 
                        finger, 
                        position,
                        direction: 'forward'
                    });
                }
            }
            
            // REVERSE: E(3) ‚Üí A(2) ‚Üí D(1) ‚Üí G(0), right to left
            for (let string = 3; string >= 0; string--) {
                for (let position = 3; position >= 0; position--) {
                    const finger = perm[position];
                    const displayFret = startFret + position;
                    const soundFret = startFret + (finger - 1);
                    notes.push({ 
                        string, 
                        displayFret, 
                        soundFret, 
                        finger, 
                        position,
                        direction: 'reverse'
                    });
                }
            }
            
            return notes;
        }
        
        function updateProgress() {
            const totalPatterns = 24;
            const notesPerPattern = 32; // 16 forward + 16 reverse
            const totalNotesInExercise = totalPatterns * notesPerPattern;
            
            const totalPlayed = (currentPermutationIndex * notesPerPattern) + currentNoteIndex;
            const percent = Math.round((totalPlayed / totalNotesInExercise) * 100);
            progressFill.style.width = `${percent}%`;
            progressText.textContent = `${percent}% Complete (Pattern ${currentPermutationIndex + 1}/24)`;
        }
        
        function playNoteWithHighlight(note, noteDuration) {
            const { string, displayFret, soundFret, finger, position, direction } = note;
            
            document.querySelectorAll('.fret').forEach(f => f.classList.remove('active'));
            
            // Highlight the DISPLAY position (left to right order)
            const fretEl = document.querySelector(`.string-line[data-string="${string}"] .fret:nth-child(${displayFret + 1})`);
            if (fretEl) {
                fretEl.classList.add('active');
                const marker = fretEl.querySelector('.fret-marker');
                marker.style.borderColor = '#fff';
            }
            
            // Play the SOUND based on finger number
            playBassNote(string, soundFret, noteDuration);
            
            const stringNames = ['G', 'D', 'A', 'E'];
            const noteName = getNoteName(string, soundFret);
            const directionText = direction === 'forward' ? '‚Üí Forward' : '‚Üê Reverse';
            
            directionIndicator.textContent = direction === 'forward' 
                ? '‚Üì Forward: G ‚Üí D ‚Üí A ‚Üí E | ‚Üí Left to Right'
                : '‚Üë Reverse: E ‚Üí A ‚Üí D ‚Üí G | ‚Üê Right to Left';
            
            exerciseInfo.innerHTML = `
                <span style="color: ${fingerColors[finger]}; font-weight: bold;">
                    Finger ${finger} (${fingerNames[finger]})
                </span> | 
                String <strong>${stringNames[string]}</strong> | 
                Fret <strong>${soundFret}</strong> |
                Note <strong>${noteName}</strong> |
                ${directionText}
            `;
            
            updateProgress();
        }
        
        function startPlayback() {
            initAudio();
            isPlaying = true;
            currentNoteIndex = 0;
            playBtn.disabled = true;
            stopBtn.disabled = false;
            
            let exercise = buildFullExercise();
            const noteInterval = (60 / tempo) * 1000;
            const noteDuration = noteInterval / 1000 * 0.85;
            
            intervalId = setInterval(() => {
                if (currentNoteIndex >= exercise.length) {
                    currentPermutationIndex++;
                    currentNoteIndex = 0;
                    
                    if (currentPermutationIndex >= allPermutations.length) {
                        currentPermutationIndex = 0;
                        stopPlayback();
                        exerciseInfo.innerHTML = 'üéâ <strong>Exercise Complete!</strong> All 24 patterns finished!';
                        progressFill.style.width = '100%';
                        progressText.textContent = '100% Complete! üéâ';
                        return;
                    }
                    
                    updatePatternDisplay();
                    exercise = buildFullExercise();
                }
                
                playNoteWithHighlight(exercise[currentNoteIndex], noteDuration);
                currentNoteIndex++;
            }, noteInterval);
        }
        
        function stopPlayback() {
            isPlaying = false;
            playBtn.disabled = false;
            stopBtn.disabled = true;
            clearInterval(intervalId);
            document.querySelectorAll('.fret').forEach(f => f.classList.remove('active'));
            if (exerciseInfo.textContent.indexOf('Complete') === -1) {
                exerciseInfo.textContent = 'Stopped';
            }
        }
        
        tempoSlider.addEventListener('input', (e) => {
            tempo = parseInt(e.target.value);
            tempoDisplay.textContent = tempo;
            if (isPlaying) {
                stopPlayback();
                startPlayback();
            }
        });
        
        startFretSlider.addEventListener('input', (e) => {
            startFret = parseInt(e.target.value);
            startFretDisplay.textContent = startFret;
            highlightCurrentPattern();
        });

        volumeSlider.addEventListener('input', (e) => {
            const volume = parseInt(e.target.value);
            volumeDisplay.textContent = volume;
            if (masterGain) masterGain.gain.value = volume / 100;
        });
        
        playBtn.addEventListener('click', startPlayback);
        stopBtn.addEventListener('click', stopPlayback);
        
        prevPatternBtn.addEventListener('click', () => {
            if (currentPermutationIndex > 0) {
                currentPermutationIndex--;
                currentNoteIndex = 0;
                updatePatternDisplay();
                updateProgress();
                if (isPlaying) {
                    stopPlayback();
                    startPlayback();
                }
            }
        });
        
        nextPatternBtn.addEventListener('click', () => {
            if (currentPermutationIndex < allPermutations.length - 1) {
                currentPermutationIndex++;
                currentNoteIndex = 0;
                updatePatternDisplay();
                updateProgress();
                if (isPlaying) {
                    stopPlayback();
                    startPlayback();
                }
            }
        });
        
        initFretboard();
        updatePatternDisplay();
        updateProgress();
    </script>
</body>
</html>
